function bkClass(){}function $BK(n){return typeof n=="string"&&(n=document.getElementById(n)),n&&!n.appendTo?bkExtend(n,bkElement.prototype):n}function __(n){return n}function resolveDocument(n){var i=document.getElementById("frame"),t=i.contentWindow||i.contentDocument;return t.document&&(t=t.document),t.getElementById(n)}var CheckClass=function(){function s(t){return t=="false"?(n=!1,!1):($("#XPathExist").show(),n=!0,!0)}function h(n){return n=="siteError"?($("#XPathResult").text("Не удалось получить текст. Попробуйте позднее"),$("#XPathResult").show(),i=!1,!1):n=="xpathError"?($("#XPathResult").text("Указанный элемент не найден"),$("#XPathResult").show(),i=!1,!1):(i=!0,n)}var n=!1,i=!1,u=undefined,f=undefined,e=undefined,t=undefined,o=undefined,r=undefined;this.Init=function(n,i,s,h,c,l){u=n;f=i;e=s;t=h;o=c;r=l};this.submitChecking=function(){$("#PreviewGif").show();var c=$("#tbXPath").val();return $.get(o+"?pageId="+t+"&xpath="+c+"&upd="+u+"&blockId="+f,s).always(function(){if(n==!0)return $("#PreviewGif").hide(),!1;$.get(r+"?projectId="+e+"&pageId="+t+"&xpath="+c,h).always(function(){$("#PreviewGif").hide();!n&&i&&$("form").submit()})}),!1};this.checkXpathExistsAndSave=function(){var i=$("#tbXPath").val();$.get(o+"?pageId="+t+"&xpath="+i+"&upd="+u+"&blockId="+f,s).always(function(){if(n==!0)return $("#PreviewGif").hide(),!1;$.ajax({url:r,type:"POST",data:{content:"<html>"+$("#frame").contents().find("html").html()+"<\/html>",xpath:$("#tbXPath").val()},success:function(n){n!="null"&&$("#lText").val(n)},error:function(){}}).always(function(){$("form").submit()})})};this.btnGetContentXPathClick=function(){$("#XPathExist").hide();$("#XPathResult").hide();var n=$("#tbXPath").val();return n.length?($("#PreviewGif").show(),$.get(r+"?projectId="+e+"&pageId="+t+"&xpath="+n,function(n){var t=h(n);t!=!1&&$("#lText").val(t)}).always(function(){$("#PreviewGif").hide()}),!1):($("#xpathValid").show(),!1)};this.btnSubmit=function(){$("#XPathExist").hide();$("#XPathResult").hide();var t=$("#tbXPath").val(),i=$("#lText").val(),n=!0;return(t.length||($("#xpathValid").show(),n=!1),i.length||($("#taValid").show(),n=!1),n==!1)?!1:(this.submitChecking(),!1)};this.tbXPathKeyUp=function(){$("#xpathValid").hide()};this.lTextKeyUp=function(){$("#taValid").hide()}},SeoTextXpathSelectorClass=function(){var n,i,r,t,u,f=!1,e="myInstance",o;this.Init=function(t,u,f){o=t;n=document.getElementById(t).contentDocument.documentElement;i=document.getElementById(u);r=f};this.Start=function(){n=document.getElementById(o).contentDocument.documentElement;s();n.onclick=function(n){if(n.preventDefault(),!f){f=!0;c(n.target);i.value=l(n.target);t=$(n.target);var u=$(n.target).attr("id");u==null&&($(n.target).attr("id",e),u=e);$(n.target).attr("contenteditable","true");r.addInstance(u)}}};this.UnblockSelector=function(){f=!1;s();h();i.value="";$("#XPathExist").hide()};var h=function(){t!=null&&(t.css("boxShadow",u),t.removeAttr("contenteditable"),r.removeInstance(t.attr("id")),t.attr("id")==e&&t.removeAttr("id"))},s=function(){n.onmouseover=function(n){u=n.target.style.boxShadow;n.target.style.boxShadow="0 0 12px red"};n.onmouseout=function(n){n.target.style.boxShadow=u}},c=function(){n.onmouseover=null;n.onmouseout=null},l=function(n){return n&&n.id?'//*[@id="'+n.id+'"]':a(n)},a=function(n){for(var i=[],r,t,u,f;n&&n.nodeType==1;n=n.parentNode){if(r=0,n&&n.id){i.splice(0,0,'/*[@id="'+n.id+'"]');break}for(t=n.previousSibling;t;t=t.previousSibling)t.nodeType!=Node.DOCUMENT_TYPE_NODE&&t.nodeName==n.nodeName&&++r;u=n.nodeName.toLowerCase();f=r?"["+(r+1)+"]":"";i.splice(0,0,u+f)}return i.length?"/"+i.join("/"):null}},bkExtend=function(){var n=arguments,t;n.length==1&&(n=[this,n[0]]);for(t in n[1])n[0][t]=n[1][t];return n[0]},bkElement,bkLib,bkEvent,nicEditorConfig,nicEditors,nicEditor,nicLinkOptions,nicLinkButton,nicImageOptions,nicImageButton,nicSaveOptions,nicEditorSaveButton;bkClass.prototype.construct=function(){};bkClass.extend=function(n){var t=function(){if(arguments[0]!==bkClass)return this.construct.apply(this,arguments)},i=new this(bkClass);return bkExtend(i,n),t.prototype=i,t.extend=this.extend,t};bkElement=bkClass.extend({construct:function(n,t){return typeof n=="string"&&(n=(t||document).createElement(n)),$BK(n)},appendTo:function(n){return n.appendChild(this),this},appendBefore:function(n){return n.parentNode.insertBefore(this,n),this},addEvent:function(n,t){return bkLib.addEvent(this,n,t),this},setContent:function(n){return this.innerHTML=n,this},pos:function(){var t=curtop=0,i=obj=this,n;if(obj.offsetParent)do t+=obj.offsetLeft,curtop+=obj.offsetTop;while(obj=obj.offsetParent);return n=window.opera?0:parseInt(this.getStyle("border-width")||this.style.border)||0,[t+n,curtop+n+this.offsetHeight]},noSelect:function(){return bkLib.noSelect(this),this},parentTag:function(n){var t=this;do{if(t&&t.nodeName&&t.nodeName.toUpperCase()==n)return t;t=t.parentNode}while(t);return!1},hasClass:function(n){return this.className.match(new RegExp("(\\s|^)nicEdit-"+n+"(\\s|$)"))},addClass:function(n){return this.hasClass(n)||(this.className+=" nicEdit-"+n),this},removeClass:function(n){return this.hasClass(n)&&(this.className=this.className.replace(new RegExp("(\\s|^)nicEdit-"+n+"(\\s|$)")," ")),this},setStyle:function(n){var i=this.style,t;for(t in n)switch(t){case"float":i.cssFloat=i.styleFloat=n[t];break;case"opacity":i.opacity=n[t];i.filter="alpha(opacity="+Math.round(n[t]*100)+")";break;case"className":this.className=n[t];break;default:i[t]=n[t]}return this},getStyle:function(n,t){var i=t?t:document.defaultView;if(this.nodeType==1)return i&&i.getComputedStyle?i.getComputedStyle(this,null).getPropertyValue(n):this.currentStyle[bkLib.camelize(n)]},remove:function(){return this.parentNode.removeChild(this),this},setAttributes:function(n){for(var t in n)this[t]=n[t];return this}});bkLib={isMSIE:navigator.appVersion.indexOf("MSIE")!=-1,addEvent:function(n,t,i){n.addEventListener?n.addEventListener(t,i,!1):n.attachEvent("on"+t,i)},toArray:function(n){for(var t=n.length,i=new Array(t);t--;)i[t]=n[t];return i},noSelect:function(n){n.setAttribute&&n.nodeName.toLowerCase()!="input"&&n.nodeName.toLowerCase()!="textarea"&&n.setAttribute("unselectable","on");for(var t=0;t<n.childNodes.length;t++)bkLib.noSelect(n.childNodes[t])},camelize:function(n){return n.replace(/\-(.)/g,function(n,t){return t.toUpperCase()})},inArray:function(n,t){return bkLib.search(n,t)!=null},search:function(n,t){for(var i=0;i<n.length;i++)if(n[i]==t)return i;return null},cancelEvent:function(n){return n=n||window.event,n.preventDefault&&n.stopPropagation&&(n.preventDefault(),n.stopPropagation()),!1},domLoad:[],domLoaded:function(){if(!arguments.callee.done)for(arguments.callee.done=!0,i=0;i<bkLib.domLoad.length;i++)bkLib.domLoad[i]()},onDomLoaded:function(n){this.domLoad.push(n);document.addEventListener?document.addEventListener("DOMContentLoaded",bkLib.domLoaded,null):bkLib.isMSIE&&(document.write("<style>.nicEdit-main p { margin: 0; }<\/style><script id=__ie_onload defer "+(location.protocol=="https:"?"src='javascript:void(0)'":"src=//0")+"><\/script>"),$BK("__ie_onload").onreadystatechange=function(){this.readyState=="complete"&&bkLib.domLoaded()});window.onload=bkLib.domLoaded}};bkEvent={addEvent:function(n,t){return t&&(this.eventList=this.eventList||{},this.eventList[n]=this.eventList[n]||[],this.eventList[n].push(t)),this},fireEvent:function(){var i=bkLib.toArray(arguments),t=i.shift(),n;if(this.eventList&&this.eventList[t])for(n=0;n<this.eventList[t].length;n++)this.eventList[t][n].apply(this,i)}};Function.prototype.closure=function(){var t=this,n=bkLib.toArray(arguments),i=n.shift();return function(){if(typeof bkLib!="undefined")return t.apply(i,n.concat(bkLib.toArray(arguments)))}};Function.prototype.closureListener=function(){var t=this,n=bkLib.toArray(arguments),i=n.shift();return function(r){var u;return r=r||window.event,u=r.target?r.target:r.srcElement,t.apply(i,[r,u].concat(n))}};nicEditorConfig=bkClass.extend({buttons:{bold:{name:__("Click to Bold"),command:"Bold",tags:["B","STRONG"],css:{"font-weight":"bold"},key:"b"},italic:{name:__("Click to Italic"),command:"Italic",tags:["EM","I"],css:{"font-style":"italic"},key:"i"},underline:{name:__("Click to Underline"),command:"Underline",tags:["U"],css:{"text-decoration":"underline"},key:"u"},left:{name:__("Left Align"),command:"justifyleft",noActive:!0},center:{name:__("Center Align"),command:"justifycenter",noActive:!0},right:{name:__("Right Align"),command:"justifyright",noActive:!0},justify:{name:__("Justify Align"),command:"justifyfull",noActive:!0},ol:{name:__("Insert Ordered List"),command:"insertorderedlist",tags:["OL"]},ul:{name:__("Insert Unordered List"),command:"insertunorderedlist",tags:["UL"]},subscript:{name:__("Click to Subscript"),command:"subscript",tags:["SUB"]},superscript:{name:__("Click to Superscript"),command:"superscript",tags:["SUP"]},strikethrough:{name:__("Click to Strike Through"),command:"strikeThrough",css:{"text-decoration":"line-through"}},removeformat:{name:__("Remove Formatting"),command:"removeformat",noActive:!0},indent:{name:__("Indent Text"),command:"indent",noActive:!0},outdent:{name:__("Remove Indent"),command:"outdent",noActive:!0},hr:{name:__("Horizontal Rule"),command:"insertHorizontalRule",noActive:!0}},iconsPath:"../../Scripts/nicEdit/nicEditorIcons.gif",frameId:"frame",buttonList:["save","bold","italic","underline","left","center","right","justify","ol","ul","fontSize","fontFamily","fontFormat","indent","outdent","image","upload","link","unlink","forecolor","bgcolor"],iconList:{bgcolor:1,forecolor:2,bold:3,center:4,hr:5,indent:6,italic:7,justify:8,left:9,ol:10,outdent:11,removeformat:12,right:13,save:24,strikethrough:15,subscript:16,superscript:17,ul:18,underline:19,image:20,link:21,unlink:22,close:23,arrow:25}});nicEditors={nicPlugins:[],editors:[],registerPlugin:function(n,t){this.nicPlugins.push({p:n,o:t})},allTextAreas:function(n){for(var i=document.getElementsByTagName("textarea"),t=0;t<i.length;t++)nicEditors.editors.push(new nicEditor(n).panelInstance(i[t]));return nicEditors.editors},findEditor:function(n){for(var i=nicEditors.editors,t=0;t<i.length;t++)if(i[t].instanceById(n))return i[t].instanceById(n)}};nicEditor=bkClass.extend({construct:function(n){var i,t;for(this.options=new nicEditorConfig,bkExtend(this.options,n),this.nicInstances=[],this.loadedPlugins=[],i=nicEditors.nicPlugins,t=0;t<i.length;t++)this.loadedPlugins.push(new i[t].p(this,i[t].o));nicEditors.editors.push(this);bkLib.addEvent(document.body,"mousedown",this.selectCheck.closureListener(this))},panelInstance:function(n,t){n=this.checkReplace($BK(n));var i=new bkElement("DIV").setStyle({width:(parseInt(n.getStyle("width"))||n.clientWidth)+"px"}).appendBefore(n);return this.setPanel(i),this.addInstance(n,t)},checkReplace:function(n){var t=nicEditors.findEditor(n);return t&&(t.removeInstance(n),t.removePanel()),n},addInstance:function(n,t){var i;return n=this.checkReplace(resolveDocument(n)),i=n.contentEditable||!!window.opera?new nicEditorInstance(n,t,this):new nicEditorIFrameInstance(n,t,this),this.nicInstances.push(i),this},removeInstance:function(n){var i,t;for(n=$BK(n),i=this.nicInstances,t=0;t<i.length;t++)i[t].e==n&&(i[t].remove(),this.nicInstances.splice(t,1))},removePanel:function(){this.nicPanel&&(this.nicPanel.remove(),this.nicPanel=null)},instanceById:function(n){var i,t;for(n=$BK(n),i=this.nicInstances,t=0;t<i.length;t++)if(i[t].e==n)return i[t]},setPanel:function(n){return this.nicPanel=new nicEditorPanel($BK(n),this.options,this),this.fireEvent("panel",this.nicPanel),this},nicCommand:function(n,t){this.selectedInstance&&this.selectedInstance.nicCommand(n,t)},getIcon:function(n,t){var i=this.options.iconList[n],r=t.iconFiles?t.iconFiles[n]:"";return{backgroundImage:"url('"+(i?this.options.iconsPath:r)+"')",backgroundPosition:(i?(i-1)*-18:0)+"px 0px"}},selectCheck:function(n,t){do if(t.className&&t.className.indexOf("nicEdit")!=-1)return!1;while(t=t.parentNode);return this.fireEvent("blur",this.selectedInstance,t),this.lastSelectedInstance=this.selectedInstance,this.selectedInstance=null,!1}});nicEditor=nicEditor.extend(bkEvent);var nicEditorInstance=bkClass.extend({isSelected:!1,construct:function(n,t,i){var u,f,e,r,o;this.ne=i;this.elm=this.e=n;this.options=t||{};newX=parseInt(n.getStyle("width"))||n.clientWidth;newY=parseInt(n.getStyle("height"))||n.clientHeight;this.initialHeight=newY-8;u=n.nodeName.toLowerCase()=="textarea";(u||this.options.hasPanel)&&(f=bkLib.isMSIE&&!(typeof document.body.style.maxHeight!="undefined"&&document.compatMode=="CSS1Compat"),e={width:newX+"px",border:"1px solid #ccc",borderTop:0,overflowY:"auto",overflowX:"hidden"},e[f?"height":"maxHeight"]=this.ne.options.maxHeight?this.ne.options.maxHeight+"px":null,this.editorContain=new bkElement("DIV").setStyle(e).appendBefore(n),r=new bkElement("DIV").setStyle({width:newX-8+"px",margin:"4px",minHeight:newY+"px"}).addClass("main").appendTo(this.editorContain),n.setStyle({display:"none"}),r.innerHTML=n.innerHTML,u&&(r.setContent(n.value),this.copyElm=n,o=n.parentTag("FORM"),o&&bkLib.addEvent(o,"submit",this.saveContent.closure(this))),r.setStyle(f?{height:newY+"px"}:{overflow:"hidden"}),this.elm=r);this.ne.addEvent("blur",this.blur.closure(this));this.init();this.blur()},init:function(){this.elm.setAttribute("contentEditable","true");this.getContent()==""&&this.setContent("<br />");this.instanceDoc=document.defaultView;this.elm.addEvent("mousedown",this.selected.closureListener(this)).addEvent("keypress",this.keyDown.closureListener(this)).addEvent("focus",this.selected.closure(this)).addEvent("blur",this.blur.closure(this)).addEvent("keyup",this.selected.closure(this));this.ne.fireEvent("add",this)},remove:function(){this.saveContent();(this.copyElm||this.options.hasPanel)&&(this.editorContain.remove(),this.e.setStyle({display:"block"}),this.ne.removePanel());this.disable();this.ne.fireEvent("remove",this)},disable:function(){this.elm.setAttribute("contentEditable","false")},getSel:function(){return window.getSelection?window.getSelection():document.selection},getRng:function(){var n=this.getSel();if(n&&n.rangeCount!==0)return n.rangeCount>0?n.getRangeAt(0):n.createRange()},selRng:function(n,t){window.getSelection?(t.removeAllRanges(),t.addRange(n)):n.select()},selElm:function(){var n=this.getRng(),t,i,r;if(n){if(n.startContainer){if(t=n.startContainer,n.cloneContents().childNodes.length==1)for(i=0;i<t.childNodes.length;i++)if(r=t.childNodes[i].ownerDocument.createRange(),r.selectNode(t.childNodes[i]),n.compareBoundaryPoints(Range.START_TO_START,r)!=1&&n.compareBoundaryPoints(Range.END_TO_END,r)!=-1)return $BK(t.childNodes[i]);return $BK(t)}return $BK(this.getSel().type=="Control"?n.item(0):n.parentElement())}},saveRng:function(){this.savedRange=this.getRng();this.savedSel=this.getSel()},restoreRng:function(){this.savedRange&&this.selRng(this.savedRange,this.savedSel)},keyDown:function(n){n.ctrlKey&&this.ne.fireEvent("key",this,n)},selected:function(n,t){if(t||(t=this.selElm)||(t=this.selElm()),!n.ctrlKey){var i=this.ne.selectedInstance;i!=this&&(i&&this.ne.fireEvent("blur",i,t),this.ne.selectedInstance=this,this.ne.fireEvent("focus",i,t));this.ne.fireEvent("selected",i,t);this.isFocused=!0;this.elm.addClass("selected")}return!1},blur:function(){this.isFocused=!1;this.elm.removeClass("selected")},saveContent:function(){(this.copyElm||this.options.hasPanel)&&(this.ne.fireEvent("save",this),this.copyElm?this.copyElm.value=this.getContent():this.e.innerHTML=this.getContent())},getElm:function(){return this.elm},getContent:function(){return this.content=this.getElm().innerHTML,this.ne.fireEvent("get",this),this.content},setContent:function(n){this.content=n;this.ne.fireEvent("set",this);this.elm.innerHTML=this.content},nicCommand:function(n,t){var r=document.getElementById("frame"),i=r.contentWindow||r.contentDocument;i.document&&(i=i.document);i.execCommand(n,!1,t)}}),nicEditorIFrameInstance=nicEditorInstance.extend({savedStyles:[],init:function(){var n=this.elm.innerHTML.replace(/^\s+|\s+$/g,""),t;this.elm.innerHTML="";n?n:n="<br />";this.initialContent=n;this.elmFrame=new bkElement("iframe").setAttributes({src:"javascript:;",frameBorder:0,allowTransparency:"true",scrolling:"no"}).setStyle({height:"100px",width:"100%"}).addClass("frame").appendTo(this.elm);this.copyElm&&this.elmFrame.setStyle({width:this.elm.offsetWidth-4+"px"});t=["font-size","font-family","font-weight","color"];for(itm in t)this.savedStyles[bkLib.camelize(itm)]=this.elm.getStyle(itm);setTimeout(this.initFrame.closure(this),50)},disable:function(){this.elm.innerHTML=this.getContent()},initFrame:function(){var n=$BK(this.elmFrame.contentWindow.document),t;n.designMode="on";n.open();t=this.ne.options.externalCSS;n.write("<html><head>"+(t?'<link href="'+t+'" rel="stylesheet" type="text/css" />':"")+'<\/head><body id="nicEditContent" style="margin: 0 !important; background-color: transparent !important;">'+this.initialContent+"<\/body><\/html>");n.close();this.frameDoc=n;this.frameWin=$BK(this.elmFrame.contentWindow);this.frameContent=$BK(this.frameWin.document.body).setStyle(this.savedStyles);this.instanceDoc=this.frameWin.document.defaultView;this.heightUpdate();this.frameDoc.addEvent("mousedown",this.selected.closureListener(this)).addEvent("keyup",this.heightUpdate.closureListener(this)).addEvent("keydown",this.keyDown.closureListener(this)).addEvent("keyup",this.selected.closure(this));this.ne.fireEvent("add",this)},getElm:function(){return this.frameContent},setContent:function(n){this.content=n;this.ne.fireEvent("set",this);this.frameContent.innerHTML=this.content;this.heightUpdate()},getSel:function(){return this.frameWin?this.frameWin.getSelection():this.frameDoc.selection},heightUpdate:function(){this.elmFrame.style.height=Math.max(this.frameContent.offsetHeight,this.initialHeight)+"px"},nicCommand:function(n,t){this.frameDoc.execCommand(n,!1,t);setTimeout(this.heightUpdate.closure(this),100)}}),nicEditorPanel=bkClass.extend({construct:function(n,t,i){this.elm=n;this.options=t;this.ne=i;this.panelButtons=[];this.buttonList=bkExtend([],this.ne.options.buttonList);this.panelContain=new bkElement("DIV").setStyle({overflow:"hidden",width:"100%",border:"1px solid #cccccc",backgroundColor:"#efefef"}).addClass("panelContain");this.panelElm=new bkElement("DIV").setStyle({margin:"2px",marginTop:"0px",zoom:1,overflow:"hidden"}).addClass("panel").appendTo(this.panelContain);this.panelContain.appendTo(n);var r=this.ne.options,u=r.buttons;for(button in u)this.addButton(button,r,!0);this.reorder();n.noSelect()},addButton:function(buttonName,options,noOrder){var button=options.buttons[buttonName],type=button.type?eval("(typeof("+button.type+') == "undefined") ? null : '+button.type+";"):nicEditorButton,hasButton=bkLib.inArray(this.buttonList,buttonName);type&&(hasButton||this.ne.options.fullPanel)&&(this.panelButtons.push(new type(this.panelElm,buttonName,options,this.ne)),hasButton||this.buttonList.push(buttonName))},findButton:function(n){for(var t=0;t<this.panelButtons.length;t++)if(this.panelButtons[t].name==n)return this.panelButtons[t]},reorder:function(){for(var i=this.buttonList,t,n=0;n<i.length;n++)t=this.findButton(i[n]),t&&this.panelElm.appendChild(t.margin)},remove:function(){this.elm.remove()}}),nicEditorButton=bkClass.extend({construct:function(n,t,i,r){this.options=i.buttons[t];this.name=t;this.ne=r;this.elm=n;this.margin=new bkElement("DIV").setStyle({float:"left",marginTop:"2px"}).appendTo(n);this.contain=new bkElement("DIV").setStyle({width:"20px",height:"20px"}).addClass("buttonContain").appendTo(this.margin);this.border=new bkElement("DIV").setStyle({backgroundColor:"#efefef",border:"1px solid #efefef"}).appendTo(this.contain);this.button=new bkElement("DIV").setStyle({width:"18px",height:"18px",overflow:"hidden",zoom:1,cursor:"pointer"}).addClass("button").setStyle(this.ne.getIcon(t,i)).appendTo(this.border);this.button.addEvent("mouseover",this.hoverOn.closure(this)).addEvent("mouseout",this.hoverOff.closure(this)).addEvent("mousedown",this.mouseClick.closure(this)).noSelect();window.opera||(this.button.onmousedown=this.button.onclick=bkLib.cancelEvent);r.addEvent("selected",this.enable.closure(this)).addEvent("blur",this.disable.closure(this)).addEvent("key",this.key.closure(this));this.disable();this.init()},init:function(){},hide:function(){this.contain.setStyle({display:"none"})},updateState:function(){this.isDisabled?this.setBg():this.isHover?this.setBg("hover"):this.isActive?this.setBg("active"):this.setBg()},setBg:function(n){var t;switch(n){case"hover":t={border:"1px solid #666",backgroundColor:"#ddd"};break;case"active":t={border:"1px solid #666",backgroundColor:"#ccc"};break;default:t={border:"1px solid #efefef",backgroundColor:"#efefef"}}this.border.setStyle(t).addClass("button-"+n)},checkNodes:function(n){var t=n;do if(this.options.tags&&bkLib.inArray(this.options.tags,t.nodeName))return this.activate(),!0;while(t=t.parentNode&&t.className!="nicEdit");for(t=$BK(n);t.nodeType==3;)t=$BK(t.parentNode);if(this.options.css)for(itm in this.options.css)if(t.getStyle(itm,this.ne.selectedInstance.instanceDoc)==this.options.css[itm])return this.activate(),!0;return this.deactivate(),!1},activate:function(){this.isDisabled||(this.isActive=!0,this.updateState(),this.ne.fireEvent("buttonActivate",this))},deactivate:function(){this.isActive=!1;this.updateState();this.isDisabled||this.ne.fireEvent("buttonDeactivate",this)},enable:function(n,t){this.isDisabled=!1;this.contain.setStyle({opacity:1}).addClass("buttonEnabled");this.updateState();this.checkNodes(t)},disable:function(){this.isDisabled=!0;this.contain.setStyle({opacity:.6}).removeClass("buttonEnabled");this.updateState()},toggleActive:function(){this.isActive?this.deactivate():this.activate()},hoverOn:function(){this.isDisabled||(this.isHover=!0,this.updateState(),this.ne.fireEvent("buttonOver",this))},hoverOff:function(){this.isHover=!1;this.updateState();this.ne.fireEvent("buttonOut",this)},mouseClick:function(){this.options.command&&(this.ne.nicCommand(this.options.command,this.options.commandArgs),this.options.noActive||this.toggleActive());this.ne.fireEvent("buttonClick",this)},key:function(n,t){this.options.key&&t.ctrlKey&&String.fromCharCode(t.keyCode||t.charCode).toLowerCase()==this.options.key&&(this.mouseClick(),t.preventDefault&&t.preventDefault())}}),nicPlugin=bkClass.extend({construct:function(n,t){this.options=t;this.ne=n;this.ne.addEvent("panel",this.loadPanel.closure(this));this.init()},loadPanel:function(n){var i=this.options.buttons,t;for(t in i)n.addButton(t,this.options);n.reorder()},init:function(){}}),nicPaneOptions={},nicEditorPane=bkClass.extend({construct:function(n,t,i,r){this.ne=t;this.elm=n;this.pos=n.pos();this.contain=new bkElement("div").setStyle({zIndex:"99999",overflow:"hidden",position:"absolute",left:this.pos[0]+"px",top:this.pos[1]+"px"});this.pane=new bkElement("div").setStyle({fontSize:"12px",border:"1px solid #ccc",overflow:"hidden",padding:"4px",textAlign:"left",backgroundColor:"#ffffc9"}).addClass("pane").setStyle(i).appendTo(this.contain);r&&!r.options.noClose&&(this.close=new bkElement("div").setStyle({float:"right",height:"16px",width:"16px",cursor:"pointer"}).setStyle(this.ne.getIcon("close",nicPaneOptions)).addEvent("mousedown",r.removePane.closure(this)).appendTo(this.pane));this.contain.noSelect().appendTo(document.body);this.position();this.init()},init:function(){},position:function(){if(this.ne.nicPanel){var n=this.ne.nicPanel.elm,i=n.pos(),t=i[0]+parseInt(n.getStyle("width"))-(parseInt(this.pane.getStyle("width"))+8);t<this.pos[0]&&this.contain.setStyle({left:t+"px"})}},toggle:function(){this.isVisible=!this.isVisible;this.contain.setStyle({display:this.isVisible?"block":"none"})},remove:function(){this.contain&&(this.contain.remove(),this.contain=null)},append:function(n){n.appendTo(this.pane)},setContent:function(n){this.pane.setContent(n)}}),nicEditorAdvancedButton=nicEditorButton.extend({init:function(){this.ne.addEvent("selected",this.removePane.closure(this)).addEvent("blur",this.removePane.closure(this))},mouseClick:function(){this.isDisabled||(this.pane&&this.pane.pane?this.removePane():(this.pane=new nicEditorPane(this.contain,this.ne,{width:this.width||"270px",backgroundColor:"#fff"},this),this.addPane(),this.ne.selectedInstance.saveRng()))},addForm:function(n,t){var i,r,f,u,e;this.form=new bkElement("form").addEvent("submit",this.submit.closureListener(this));this.pane.append(this.form);this.inputs={};for(itm in n)if(i=n[itm],r="",t&&(r=t.getAttribute(itm)),r||(r=i.value||""),f=n[itm].type,f=="title")new bkElement("div").setContent(i.txt).setStyle({fontSize:"14px",fontWeight:"bold",padding:"0px",margin:"2px 0"}).appendTo(this.form);else{u=new bkElement("div").setStyle({overflow:"hidden",clear:"both"}).appendTo(this.form);i.txt&&new bkElement("label").setAttributes({"for":itm}).setContent(i.txt).setStyle({margin:"2px 4px",fontSize:"13px",width:"50px",lineHeight:"20px",textAlign:"right",float:"left"}).appendTo(u);switch(f){case"text":this.inputs[itm]=new bkElement("input").setAttributes({id:itm,value:r,type:"text"}).setStyle({margin:"2px 0",fontSize:"13px",float:"left",height:"20px",border:"1px solid #ccc",overflow:"hidden"}).setStyle(i.style).appendTo(u);break;case"select":this.inputs[itm]=new bkElement("select").setAttributes({id:itm}).setStyle({border:"1px solid #ccc",float:"left",margin:"2px 0"}).appendTo(u);for(opt in i.options)e=new bkElement("option").setAttributes({value:opt,selected:opt==r?"selected":""}).setContent(i.options[opt]).appendTo(this.inputs[itm]);break;case"content":this.inputs[itm]=new bkElement("textarea").setAttributes({id:itm}).setStyle({border:"1px solid #ccc",float:"left"}).setStyle(i.style).appendTo(u);this.inputs[itm].value=r}}new bkElement("input").setAttributes({type:"submit"}).setStyle({backgroundColor:"#efefef",border:"1px solid #ccc",margin:"3px 0",float:"left",clear:"both"}).appendTo(this.form);this.form.onsubmit=bkLib.cancelEvent},submit:function(){},findElm:function(n,t,i){for(var u=this.ne.selectedInstance.getElm().getElementsByTagName(n),r=0;r<u.length;r++)if(u[r].getAttribute(t)==i)return $BK(u[r])},removePane:function(){this.pane&&(this.pane.remove(),this.pane=null,this.ne.selectedInstance.restoreRng())}}),nicButtonTips=bkClass.extend({construct:function(n){this.ne=n;n.addEvent("buttonOver",this.show.closure(this)).addEvent("buttonOut",this.hide.closure(this))},show:function(n){this.timer=setTimeout(this.create.closure(this,n),400)},create:function(n){this.timer=null;this.pane||(this.pane=new nicEditorPane(n.button,this.ne,{fontSize:"12px",marginTop:"5px"}),this.pane.setContent(n.options.name))},hide:function(){this.timer&&clearTimeout(this.timer);this.pane&&(this.pane=this.pane.remove())}});nicEditors.registerPlugin(nicButtonTips);var nicSelectOptions={buttons:{fontSize:{name:__("Select Font Size"),type:"nicEditorFontSizeSelect",command:"fontsize"},fontFamily:{name:__("Select Font Family"),type:"nicEditorFontFamilySelect",command:"fontname"},fontFormat:{name:__("Select Font Format"),type:"nicEditorFontFormatSelect",command:"formatBlock"}}},nicEditorSelect=bkClass.extend({construct:function(n,t,i,r){this.options=i.buttons[t];this.elm=n;this.ne=r;this.name=t;this.selOptions=[];this.margin=new bkElement("div").setStyle({float:"left",margin:"2px 1px 0 1px"}).appendTo(this.elm);this.contain=new bkElement("div").setStyle({width:"90px",height:"20px",cursor:"pointer",overflow:"hidden"}).addClass("selectContain").addEvent("click",this.toggle.closure(this)).appendTo(this.margin);this.items=new bkElement("div").setStyle({overflow:"hidden",zoom:1,border:"1px solid #ccc",paddingLeft:"3px",backgroundColor:"#fff"}).appendTo(this.contain);this.control=new bkElement("div").setStyle({overflow:"hidden",float:"right",height:"18px",width:"16px"}).addClass("selectControl").setStyle(this.ne.getIcon("arrow",i)).appendTo(this.items);this.txt=new bkElement("div").setStyle({overflow:"hidden",float:"left",width:"66px",height:"14px",marginTop:"1px",fontFamily:"sans-serif",textAlign:"center",fontSize:"12px"}).addClass("selectTxt").appendTo(this.items);window.opera||(this.contain.onmousedown=this.control.onmousedown=this.txt.onmousedown=bkLib.cancelEvent);this.margin.noSelect();this.ne.addEvent("selected",this.enable.closure(this)).addEvent("blur",this.disable.closure(this));this.disable();this.init()},disable:function(){this.isDisabled=!0;this.close();this.contain.setStyle({opacity:.6})},enable:function(){this.isDisabled=!1;this.close();this.contain.setStyle({opacity:1})},setDisplay:function(n){this.txt.setContent(n)},toggle:function(){this.isDisabled||(this.pane?this.close():this.open())},open:function(){var n;for(this.pane=new nicEditorPane(this.items,this.ne,{width:"88px",padding:"0px",borderTop:0,borderLeft:"1px solid #ccc",borderRight:"1px solid #ccc",borderBottom:"0px",backgroundColor:"#fff"}),n=0;n<this.selOptions.length;n++){var i=this.selOptions[n],r=new bkElement("div").setStyle({overflow:"hidden",borderBottom:"1px solid #ccc",width:"88px",textAlign:"left",overflow:"hidden",cursor:"pointer"}),t=new bkElement("div").setStyle({padding:"0px 4px"}).setContent(i[1]).appendTo(r).noSelect();t.addEvent("click",this.update.closure(this,i[0])).addEvent("mouseover",this.over.closure(this,t)).addEvent("mouseout",this.out.closure(this,t)).setAttributes("id",i[0]);this.pane.append(r);window.opera||(t.onmousedown=bkLib.cancelEvent)}},close:function(){this.pane&&(this.pane=this.pane.remove())},over:function(n){n.setStyle({backgroundColor:"#ccc"})},out:function(n){n.setStyle({backgroundColor:"#fff"})},add:function(n,t){this.selOptions.push([n,t])},update:function(n){this.ne.nicCommand(this.options.command,n);this.close()}}),nicEditorFontSizeSelect=nicEditorSelect.extend({sel:{1:"1&nbsp;(8pt)",2:"2&nbsp;(10pt)",3:"3&nbsp;(12pt)",4:"4&nbsp;(14pt)",5:"5&nbsp;(18pt)",6:"6&nbsp;(24pt)"},init:function(){this.setDisplay("Font&nbsp;Size...");for(itm in this.sel)this.add(itm,'<font size="'+itm+'">'+this.sel[itm]+"<\/font>")}}),nicEditorFontFamilySelect=nicEditorSelect.extend({sel:{arial:"Arial","comic sans ms":"Comic Sans","courier new":"Courier New",georgia:"Georgia",helvetica:"Helvetica",impact:"Impact","times new roman":"Times","trebuchet ms":"Trebuchet",verdana:"Verdana"},init:function(){this.setDisplay("Font&nbsp;Family...");for(itm in this.sel)this.add(itm,'<font face="'+itm+'">'+this.sel[itm]+"<\/font>")}}),nicEditorFontFormatSelect=nicEditorSelect.extend({sel:{p:"Paragraph",pre:"Pre",h6:"Heading&nbsp;6",h5:"Heading&nbsp;5",h4:"Heading&nbsp;4",h3:"Heading&nbsp;3",h2:"Heading&nbsp;2",h1:"Heading&nbsp;1"},init:function(){this.setDisplay("Font&nbsp;Format...");for(itm in this.sel){var n=itm.toUpperCase();this.add("<"+n+">","<"+itm+' style="padding: 0px; margin: 0px;">'+this.sel[itm]+"<\/"+n+">")}}});nicEditors.registerPlugin(nicPlugin,nicSelectOptions);nicLinkOptions={buttons:{link:{name:"Add Link",type:"nicLinkButton",tags:["A"]},unlink:{name:"Remove Link",command:"unlink",noActive:!0}}};nicLinkButton=nicEditorAdvancedButton.extend({addPane:function(){this.ln=this.ne.selectedInstance.selElm().parentTag("A");this.addForm({"":{type:"title",txt:"Add/Edit Link"},href:{type:"text",txt:"URL",value:"http://",style:{width:"150px"}},title:{type:"text",txt:"Title"},target:{type:"select",txt:"Open In",options:{"":"Current Window",_blank:"New Window"},style:{width:"100px"}}},this.ln)},submit:function(){var t=this.inputs.href.value,n;if(t=="http://"||t=="")return alert("You must enter a URL to Create a Link"),!1;this.removePane();this.ln||(n="javascript:nicTemp();",this.ne.nicCommand("createlink",n),this.ln=this.findElm("A","href",n));this.ln&&this.ln.setAttributes({href:this.inputs.href.value,title:this.inputs.title.value,target:this.inputs.target.options[this.inputs.target.selectedIndex].value})}});nicEditors.registerPlugin(nicPlugin,nicLinkOptions);var nicColorOptions={buttons:{forecolor:{name:__("Change Text Color"),type:"nicEditorColorButton",noClose:!0},bgcolor:{name:__("Change Background Color"),type:"nicEditorBgColorButton",noClose:!0}}},nicEditorColorButton=nicEditorAdvancedButton.extend({addPane:function(){var n={0:"00",1:"33",2:"66",3:"99",4:"CC",5:"FF"},r=new bkElement("DIV").setStyle({width:"270px"}),u,f,e;for(u in n)for(f in n)for(e in n){var t="#"+n[u]+n[e]+n[f],o=new bkElement("DIV").setStyle({cursor:"pointer",height:"15px",float:"left"}).appendTo(r),i=new bkElement("DIV").setStyle({border:"2px solid "+t}).appendTo(o),s=new bkElement("DIV").setStyle({backgroundColor:t,overflow:"hidden",width:"11px",height:"11px"}).addEvent("click",this.colorSelect.closure(this,t)).addEvent("mouseover",this.on.closure(this,i)).addEvent("mouseout",this.off.closure(this,i,t)).appendTo(i);window.opera||(o.onmousedown=s.onmousedown=bkLib.cancelEvent)}this.pane.append(r.noSelect())},colorSelect:function(n){this.ne.nicCommand("foreColor",n);this.removePane()},on:function(n){n.setStyle({border:"2px solid #000"})},off:function(n,t){n.setStyle({border:"2px solid "+t})}}),nicEditorBgColorButton=nicEditorColorButton.extend({colorSelect:function(n){this.ne.nicCommand("hiliteColor",n);this.removePane()}});nicEditors.registerPlugin(nicPlugin,nicColorOptions);nicImageOptions={buttons:{image:{name:"Add Image",type:"nicImageButton",tags:["IMG"]}}};nicImageButton=nicEditorAdvancedButton.extend({addPane:function(){this.im=this.ne.selectedInstance.selElm().parentTag("IMG");this.addForm({"":{type:"title",txt:"Add/Edit Image"},src:{type:"text",txt:"URL",value:"http://",style:{width:"150px"}},alt:{type:"text",txt:"Alt Text",style:{width:"100px"}},align:{type:"select",txt:"Align",options:{none:"Default",left:"Left",right:"Right"}}},this.im)},submit:function(){var t=this.inputs.src.value,n;if(t==""||t=="http://")return alert("You must enter a Image URL to insert"),!1;this.removePane();this.im||(n="javascript:nicImTemp();",this.ne.nicCommand("insertImage",n),this.im=this.findElm("IMG","src",n));this.im&&this.im.setAttributes({src:this.inputs.src.value,alt:this.inputs.alt.value,align:this.inputs.align.value})}});nicEditors.registerPlugin(nicPlugin,nicImageOptions);nicSaveOptions={buttons:{save:{name:__("Save this content"),type:"nicEditorSaveButton"}}};nicEditorSaveButton=nicEditorButton.extend({init:function(){this.ne.options.onSave||this.margin.setStyle({display:"none"})},mouseClick:function(){var t=this.ne.options.onSave,n=this.ne.selectedInstance;t(n.getContent(),n.elm.id,n)}});nicEditors.registerPlugin(nicPlugin,nicSaveOptions)